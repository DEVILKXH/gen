<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:util="http://www.springframework.org/schema/util" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="
  http://www.springframework.org/schema/beans
  http://www.springframework.org/schema/beans/spring-beans.xsd
  http://www.springframework.org/schema/util
  http://www.springframework.org/schema/util/spring-util.xsd
  http://www.springframework.org/schema/context 
  http://www.springframework.org/schema/context/spring-context.xsd
  http://www.springframework.org/schema/mvc
  http://www.springframework.org/schema/mvc/spring-mvc.xsd
  http://www.springframework.org/schema/tx
  http://www.springframework.org/schema/tx/spring-tx.xsd">

	<!-- ${application}自己的数据源 -->
	<!-- 数据源 -->
	<bean id="ds_${application}"
		class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
		<property name="driverClassName" value="${${application}.driverClassName}" />
		<property name="url" value="${${application}.url}" />
		<property name="username" value="${${application}.username}" />
		<property name="password" value="${${application}.password}" />
		<property name="initialSize" value="${${application}.initialSize}"/>
		<property name="maxActive" value="${${application}.maxActive}"/>
		<property name="minIdle" value="${${application}.minIdle}"/>
		<property name="maxIdle" value="${${application}.maxIdle}"/>  
		<property name="maxWait" value="${${application}.maxWait}"/>
		<!-- <property name="removeAbandoned"  value="${${application}.removeAbandoned}"/>
		<property name="removeAbandonedTimeout" value="${${application}.removeAbandonedTimeout}"/>	 -->
		<!-- 下面两个属性是必须的，否则连接超时后不会自动重连 -->
    	<property name="validationQuery" value="SELECT 1 FROM DUAL" />
    	<property name="testOnBorrow" value="true"/>
	</bean>
	
	<!-- 事务 -->
	<bean id="txn_${application}"
        class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="ds_${application}" />
    </bean>
    <tx:annotation-driven transaction-manager="txn_${application}" />

	<!-- 会话工厂 -->
	<bean id="sf_${application}" class="org.mybatis.spring.SqlSessionFactoryBean">
		<property name="dataSource" ref="ds_${application}" />
		<!-- mapper路径 -->
		<property name="mapperLocations">
			<list>
				<!-- 如果要扫描jar中的Mapper，必须使用全名或者classpath* -->
				<value>classpath*:META-INF/*/mybatis/${application}/*-mapper.xml</value>
			</list>
		</property>
	</bean>

	<!-- 会话模板 -->
	<bean id="st_${application}" class="org.mybatis.spring.SqlSessionTemplate">
		<constructor-arg index="0" ref="sf_${application}" />
	</bean>

</beans>